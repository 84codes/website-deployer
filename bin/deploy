#!/usr/bin/env ruby
$stdout.sync = $stderr.sync = true
require 'bundler/setup'
require_relative '../website'

name = ARGV[0]
puts "Deploying #{name}"
repo_url = "https://bitbucket.org/84codes/#{name}-website.git"
domain = "www.#{name}.com"
path = "/tmp/#{name}-#{rand}"
begin
  FileUtils.mkdir_p path
  Dir.chdir path do
    system "git clone --depth 1 #{repo_url} ."
    Website.new(domain).upload
  end
  puts "#{domain} deployed"
ensure
  FileUtils.rm_rf path
end

